<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tactics & Treats ‚Äì Admin Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />

<style>
body {
  background: linear-gradient(to right, #000, #660000);
  color: white;
  font-family: 'Poppins', sans-serif;
}
.tab-btn {
  cursor: pointer;
  padding: 10px 20px;
  font-weight: bold;
  border-radius: 10px 10px 0 0;
  background: #800000;
  color: white;
  margin-right: 5px;
  transition: 0.3s;
}
.tab-btn.active { background: #ff0000; }
.table-container { overflow-x: auto; margin-top: 10px; }
th, td { padding: 10px; text-align: left; }
th { background: #700000; }
tr:nth-child(even) { background: #111; }
tr:nth-child(odd) { background: #222; }
input, select {
  background: #333;
  border: 1px solid #555;
  color: white;
  padding: 4px;
  border-radius: 5px;
  width: 100%;
}
button {
  background: #b00;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 5px 10px;
  cursor: pointer;
}
button:hover { background: #e00; }
.add-section {
  background: #111;
  border: 1px solid #333;
  border-radius: 10px;
  padding: 10px;
  margin-top: 15px;
}
</style>
</head>

<body class="min-h-screen py-10 px-4">
  <h1 class="text-3xl font-bold text-center mb-8">Admin Dashboard ‚Äì Tactics & Treats</h1>

  <div class="flex justify-center mb-6">
    <div id="tabCookies" class="tab-btn active">üç™ Cookies</div>
    <div id="tabBracelets" class="tab-btn">üßµ Bracelets</div>
  </div>

  <!-- PRODUCTS TABLE -->
  <section class="table-container">
    <h2 class="text-xl font-semibold mb-2">Products</h2>
    <table class="min-w-full text-sm border border-gray-700 rounded">
      <thead>
        <tr>
          <th>Name / Type</th>
          <th>SKU</th>
          <th>Price</th>
          <th>Stock</th>
          <th>Supplier</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="productsTable">
        <tr><td colspan="6" class="text-center p-4 text-gray-400">Loading...</td></tr>
      </tbody>
    </table>

    <!-- ADD NEW PRODUCT -->
    <div class="add-section">
      <h3 class="text-lg mb-2 font-semibold">‚ûï Add New Product</h3>
      <div class="grid grid-cols-5 gap-2">
        <input id="newName" placeholder="Name / Type" />
        <input id="newSKU" placeholder="SKU" />
        <input id="newPrice" type="number" step="0.01" placeholder="Price" />
        <input id="newStock" type="number" placeholder="Stock" />
        <input id="newSupplier" placeholder="Supplier" />
      </div>
      <button class="mt-3" id="addProductBtn">Save Product</button>
    </div>
  </section>

  <!-- ORDERS TABLE -->
  <section class="table-container mt-10">
    <h2 class="text-xl font-semibold mb-2">Orders</h2>
    <table class="min-w-full text-sm border border-gray-700 rounded">
      <thead>
        <tr>
          <th>Order #</th>
          <th>Name</th>
          <th>Email</th>
          <th>Product / Type</th>
          <th>SKU</th>
          <th>Qty</th>
          <th>Total</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="ordersTable">
        <tr><td colspan="9" class="text-center p-4 text-gray-400">Loading...</td></tr>
      </tbody>
    </table>
  </section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { 
  getFirestore, collection, getDocs, deleteDoc, doc, updateDoc, addDoc
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCiZuaANb1lrgdn-aARGJ_TRhgzPPUug58",
  authDomain: "bracelets-and-color.firebaseapp.com",
  projectId: "bracelets-and-color",
  storageBucket: "bracelets-and-color.firebasestorage.app",
  messagingSenderId: "382292570673",
  appId: "1:382292570673:web:1c966e2e7e8fc2efa31b10",
  measurementId: "G-BJPQN6S7YB"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentTab = "cookies";
const tabCookies = document.getElementById("tabCookies");
const tabBracelets = document.getElementById("tabBracelets");
const productsTable = document.getElementById("productsTable");
const ordersTable = document.getElementById("ordersTable");

tabCookies.addEventListener("click", () => {
  currentTab = "cookies";
  tabCookies.classList.add("active");
  tabBracelets.classList.remove("active");
  loadData();
});
tabBracelets.addEventListener("click", () => {
  currentTab = "bracelets";
  tabBracelets.classList.add("active");
  tabCookies.classList.remove("active");
  loadData();
});

async function loadData() {
  productsTable.innerHTML = "<tr><td colspan='6' class='text-center p-4 text-gray-400'>Loading...</td></tr>";
  ordersTable.innerHTML = "<tr><td colspan='9' class='text-center p-4 text-gray-400'>Loading...</td></tr>";

  const prodCol = collection(db, currentTab === "cookies" ? "products_cookies" : "products_bracelets");
  const orderCol = collection(db, currentTab === "cookies" ? "cookieOrders" : "braceletOrders");

  try {
    const [prodSnap, orderSnap] = await Promise.all([
      getDocs(prodCol), getDocs(orderCol)
    ]);
    renderProducts(prodSnap.docs);
    renderOrders(orderSnap.docs);
  } catch (err) {
    console.error(err);
  }
}

function renderProducts(docs) {
  if (docs.length === 0) {
    productsTable.innerHTML = `<tr><td colspan='6' class='text-center text-gray-400'>No products found</td></tr>`;
    return;
  }
  productsTable.innerHTML = "";
  docs.forEach(docSnap => {
    const d = docSnap.data();
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><input value="${d.name || d.type || ""}" id="name-${docSnap.id}"></td>
      <td><input value="${d.sku || ""}" id="sku-${docSnap.id}"></td>
      <td><input type="number" step="0.01" value="${d.price || 0}" id="price-${docSnap.id}"></td>
      <td><input type="number" value="${d.stock ?? 0}" id="stock-${docSnap.id}"></td>
      <td><input value="${d.supplier || ""}" id="supplier-${docSnap.id}"></td>
      <td class="flex gap-2">
        <button onclick="saveProduct('${docSnap.id}')">üíæ Save</button>
        <button onclick="deleteProduct('${docSnap.id}')">üóëÔ∏è</button>
      </td>
    `;
    productsTable.appendChild(tr);
  });
}

function renderOrders(docs) {
  if (docs.length === 0) {
    ordersTable.innerHTML = `<tr><td colspan='9' class='text-center text-gray-400'>No orders found</td></tr>`;
    return;
  }
  ordersTable.innerHTML = "";
  docs.forEach((docSnap, index) => {
    const d = docSnap.data();
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>#${index + 1}</td>
      <td><input value="${d.name || ""}" id="oname-${docSnap.id}"></td>
      <td><input value="${d.email || ""}" id="oemail-${docSnap.id}"></td>
      <td><input value="${d.product || d.type || ""}" id="otype-${docSnap.id}"></td>
      <td><input value="${d.sku || ""}" id="osku-${docSnap.id}"></td>
      <td><input type="number" value="${d.quantity || d.qty || 1}" id="oqty-${docSnap.id}"></td>
      <td><input type="number" step="0.01" value="${d.totalPrice || d.price || 0}" id="ototal-${docSnap.id}"></td>
      <td>
        <select id="ostatus-${docSnap.id}">
          ${["Pending","Processing","Completed","Cancelled"].map(s =>
            `<option value="${s}" ${d.status===s?"selected":""}>${s}</option>`).join("")}
        </select>
      </td>
      <td class="flex gap-2">
        <button onclick="saveOrder('${docSnap.id}')">üíæ</button>
        <button onclick="deleteOrder('${docSnap.id}')">üóëÔ∏è</button>
      </td>
    `;
    ordersTable.appendChild(tr);
  });
}

window.saveProduct = async (id) => {
  const col = collection(db, currentTab === "cookies" ? "products_cookies" : "products_bracelets");
  const ref = doc(col, id);
  await updateDoc(ref, {
    name: document.getElementById(`name-${id}`).value.trim(),
    sku: document.getElementById(`sku-${id}`).value.trim(),
    price: parseFloat(document.getElementById(`price-${id}`).value) || 0,
    stock: parseInt(document.getElementById(`stock-${id}`).value) || 0,
    supplier: document.getElementById(`supplier-${id}`).value.trim(),
  });
  alert("‚úÖ Product updated!");
};

window.saveOrder = async (id) => {
  const col = collection(db, currentTab === "cookies" ? "cookieOrders" : "braceletOrders");
  const ref = doc(col, id);
  await updateDoc(ref, {
    name: document.getElementById(`oname-${id}`).value.trim(),
    email: document.getElementById(`oemail-${id}`).value.trim(),
    type: document.getElementById(`otype-${id}`).value.trim(),
    sku: document.getElementById(`osku-${id}`).value.trim(),
    quantity: parseInt(document.getElementById(`oqty-${id}`).value) || 1,
    totalPrice: parseFloat(document.getElementById(`ototal-${id}`).value) || 0,
    status: document.getElementById(`ostatus-${id}`).value,
  });
  alert("‚úÖ Order updated!");
};

window.deleteProduct = async (id) => {
  const col = collection(db, currentTab === "cookies" ? "products_cookies" : "products_bracelets");
  await deleteDoc(doc(col, id));
  loadData();
};

window.deleteOrder = async (id) => {
  const col = collection(db, currentTab === "cookies" ? "cookieOrders" : "braceletOrders");
  await deleteDoc(doc(col, id));
  loadData();
};

// Add Product
document.getElementById("addProductBtn").addEventListener("click", async () => {
  const name = document.getElementById("newName").value.trim();
  const sku = document.getElementById("newSKU").value.trim();
  const price = parseFloat(document.getElementById("newPrice").value) || 0;
  const stock = parseInt(document.getElementById("newStock").value) || 0;
  const supplier = document.getElementById("newSupplier").value.trim();

  if (!name || !sku) {
    alert("‚ö†Ô∏è Please fill out both Name and SKU.");
    return;
  }

  const col = collection(db, currentTab === "cookies" ? "products_cookies" : "products_bracelets");
  await addDoc(col, { name, sku, price, stock, supplier });

  document.getElementById("newName").value = "";
  document.getElementById("newSKU").value = "";
  document.getElementById("newPrice").value = "";
  document.getElementById("newStock").value = "";
  document.getElementById("newSupplier").value = "";

  loadData();
  alert("‚úÖ Product added!");
});

loadData();
</script>
</body>
</html>
