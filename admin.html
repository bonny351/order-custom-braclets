<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tactics & Treats â€“ Admin Panel</title>

<style>
body {
  font-family: "Poppins", sans-serif;
  background:#111;
  color:white;
  margin:0;
  padding:20px;
}

h1,h2 {
  text-align:center;
  color:#ff0000;
  margin-bottom:20px;
}

header {
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(90deg,#7a0c0c,#000);
  padding:15px;
  border-radius:10px;
  margin-bottom:20px;
  box-shadow:0 0 12px rgba(255,0,0,0.4);
}

.tabs, .subTabs {
  display:flex;
  justify-content:center;
  margin-bottom:15px;
  gap:10px;
  flex-wrap:wrap;
}

.tab, .subTab {
  padding:10px 20px;
  cursor:pointer;
  border-radius:5px;
  background:#222;
  color:white;
  font-weight:bold;
}

.tab.active, .subTab.active {
  background:#ff0000;
  box-shadow:0 0 8px #ff0000;
}

section {
  background:#181818;
  padding:20px;
  border-radius:12px;
  box-shadow:0 0 12px rgba(255,0,0,0.2);
}

table {
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}

th,td {
  border:1px solid #ff0000;
  padding:10px;
  text-align:center;
}

tr:nth-child(even) { background:#222; }

.statusSelect {
  padding:6px;
  background:#222;
  color:white;
  border:1px solid #ff0000;
  border-radius:5px;
}

/* STATUS COLORS */
.doneRow    { background:rgba(0,255,0,0.25)!important; }
.newRow     { background:rgba(255,255,0,0.25)!important; }
.deletedRow { background:rgba(255,0,0,0.25)!important; }
</style>
</head>
<body>

<header><h1>Tactics & Treats Admin Panel</h1></header>

<div class="tabs">
  <div class="tab active" onclick="setMain('orders')">Orders</div>
  <div class="tab" onclick="setMain('products')">Products</div>
</div>

<section>
  <h2 id="tableTitle">Orders</h2>
  <input id="searchInput" placeholder="ðŸ” Search..." style="width:90%;max-width:400px;margin:auto;display:block;">
  <p id="tableMsg" style="text-align:center;color:#ffb347;"></p>
  <table id="dynamicTable"></table>
</section>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import {
  getFirestore, collection, getDocs,
  doc, setDoc, deleteDoc
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

/* ðŸ”¥ FIREBASE */
const firebaseConfig={
  apiKey:"AIzaSyCiZuaANb1lrgdn-aARGJ_TRhgzPPUug58",
  authDomain:"bracelets-and-color.firebaseapp.com",
  projectId:"bracelets-and-color",
  storageBucket:"bracelets-and-color.appspot.com",
  messagingSenderId:"382292570673",
  appId:"1:382292570673:web:1c966e2e7e8fc2efa31b10"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

let currentMode="orders";
let currentCollection="orders";

const table=document.getElementById("dynamicTable");
const title=document.getElementById("tableTitle");
const msg=document.getElementById("tableMsg");

/* MAIN TAB SWITCH */
window.setMain = mode => {
  currentMode=mode;
  currentCollection = mode==="orders" ? "orders" : "products";
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  event.target.classList.add("active");
  loadTable();
};

/* STATUS COLOR */
function colorRow(row,status){
  row.classList.remove("doneRow","newRow","deletedRow");
  if(status==="done") row.classList.add("doneRow");
  else if(status==="new") row.classList.add("newRow");
  else if(status==="deleted") row.classList.add("deletedRow");
}

/* STATUS DROPDOWN */
function statusDropdown(row,data,id){
  const s=document.createElement("select");
  s.className="statusSelect";
  ["new","done","deleted"].forEach(v=>{
    const o=new Option(v,v);
    if(data.status===v) o.selected=true;
    s.add(o);
  });

  colorRow(row,data.status);

  s.onchange=async()=>{
    data.status=s.value;
    await setDoc(doc(db,currentCollection,id),data);
    colorRow(row,data.status);
    msg.textContent="âœ” Status updated";
  };
  return s;
}

/* LOAD TABLE */
async function loadTable(){
  table.innerHTML="";
  title.textContent=currentMode.toUpperCase();

  const snap=await getDocs(collection(db,currentCollection));
  if(snap.empty){
    table.innerHTML="<tr><td>No data</td></tr>";
    return;
  }

  const keys=new Set(["status"]);
  snap.forEach(d=>Object.keys(d.data()).forEach(k=>keys.add(k)));
  const cols=[...keys];

  const header=table.insertRow();
  header.insertCell().textContent="Status";
  cols.forEach(k=>{
    const th=document.createElement("th");
    th.textContent=k;
    header.appendChild(th);
  });

  snap.forEach(docSnap=>{
    const data=docSnap.data();
    const row=table.insertRow();

    const sc=row.insertCell();
    sc.appendChild(statusDropdown(row,data,docSnap.id));

    cols.forEach(k=>{
      const c=row.insertCell();
      c.textContent=data[k] ?? "";
      c.contentEditable=true;

      c.onblur=async()=>{
        data[k]=c.textContent.trim();
        await setDoc(doc(db,currentCollection,docSnap.id),data);
        msg.textContent=`âœ” Updated ${k}`;
      };
    });

    colorRow(row,data.status);
  });
}

/* SEARCH */
searchInput.oninput=()=>{
  const t=searchInput.value.toLowerCase();
  [...table.rows].forEach((r,i)=>{
    if(i===0) return;
    r.style.display=r.textContent.toLowerCase().includes(t)?"":"none";
  });
};

loadTable();
</script>
</body>
</html>
