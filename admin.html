<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel ‚Äì Tactics & Treats</title>
<style>
/* ---------- Base Styles ---------- */
body { font-family:"Poppins",sans-serif; background:#111; color:white; margin:0; padding:20px;}
h1,h2 { text-align:center; color:#ff0000; margin-bottom:20px; }
section { background:#181818; padding:20px; border-radius:12px; box-shadow:0 0 12px rgba(255,0,0,0.2); margin-bottom:30px; transition:opacity 0.3s; }
.flex { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:10px; }
.flex input, .flex select { flex:1; padding:8px; border-radius:5px; border:none; font-size:14px;}
button { padding:10px 16px; background:#ff0000; color:white; font-weight:bold; border:none; border-radius:8px; cursor:pointer; transition:0.2s; }
button:hover { background:darkred; box-shadow:0 0 8px #ff0000; }
.message { color:#ffb347; font-weight:bold; text-align:center; margin-top:10px;}
.tabs { display:flex; justify-content:center; margin-bottom:15px; gap:10px; }
.tab { padding:10px 20px; cursor:pointer; border-radius:5px; background:#222; color:#fff; font-weight:bold; transition:0.2s; }
.tab.active { background:#ff0000; color:#fff; box-shadow:0 0 8px #ff0000; }
.tab:hover { background:#ff4444; }
table { width:100%; border-collapse:collapse; margin-top:10px; display:block; overflow-x:auto; white-space:nowrap; }
th,td { padding:10px; border:1px solid #ff0000; text-align:center; }
th { background:#222; color:#ffb347; position:sticky; top:0; z-index:1; }
tr:nth-child(even) { background:#222; }
tr:hover { background:#333; transition:0.2s; }
#searchProduct { width:100%; max-width:400px; margin:10px auto; display:block; padding:8px; border-radius:5px; border:none; font-size:14px; }
</style>
</head>
<body>

<h1>Admin Panel ‚Äì Tactics & Treats</h1>

<div class="tabs">
  <div class="tab active" data-category="bracelets">üßµ Bracelets</div>
  <div class="tab" data-category="cookies">üç™ Cookies</div>
  <div class="tab" data-category="spirit">üëï Spirit Wear</div>
</div>

<section id="productManager">
<h2>Manage Products</h2>
<input type="text" id="searchProduct" placeholder="üîç Search products...">
<form id="productForm">
  <div class="flex">
    <input id="productId" type="text" placeholder="Product ID (for editing only)">
    <input id="productType" type="text" placeholder="Product Name / Type" required>
    <input id="productPrice" type="text" placeholder="Price (number or JSON for sizes)" required>
  </div>
  <div class="flex">
    <input id="productStock" type="number" placeholder="Stock" required>
    <input id="productSizes" type="text" placeholder="Sizes (comma separated)">
    <input id="productColors" type="text" placeholder="Colors (comma separated)">
  </div>
  <div class="flex">
    <button type="button" id="addProductBtn">Add Product</button>
    <button type="button" id="updateProductBtn">Update Product</button>
    <button type="button" id="deleteProductBtn">Delete Product</button>
    <button type="button" id="reAddBraceletsBtn">üîÑ Re-add All Bracelets</button>
  </div>
  <p id="productMsg" class="message"></p>
</form>

<table id="productTable">
<tr><th>ID</th><th>Name</th><th>Price</th><th>Stock</th><th>Sizes</th><th>Colors</th></tr>
</table>
</section>

<section id="orderManager">
<h2>Orders</h2>
<table id="ordersTable">
<tr>
<th>Category</th><th>Name</th><th>Email</th><th>Product</th><th>Size</th><th>Qty</th><th>Total</th><th>Status</th>
</tr>
</table>
<p id="orderMsg" class="message"></p>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, doc, setDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey:"AIzaSyCiZuaANb1lrgdn-aARGJ_TRhgzPPUug58",
  authDomain:"bracelets-and-color.firebaseapp.com",
  projectId:"bracelets-and-color",
  storageBucket:"bracelets-and-color.appspot.com",
  messagingSenderId:"382292570673",
  appId:"1:382292570673:web:1c966e2e7e8fc2efa31b10"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// --- DOM Elements ---
const tabs = document.querySelectorAll(".tab");
let currentCategory = "bracelets";

const productIdInput = document.getElementById("productId");
const productTypeInput = document.getElementById("productType");
const productPriceInput = document.getElementById("productPrice");
const productStockInput = document.getElementById("productStock");
const productSizesInput = document.getElementById("productSizes");
const productColorsInput = document.getElementById("productColors");
const productMsg = document.getElementById("productMsg");
const productTable = document.getElementById("productTable");
const ordersTable = document.getElementById("ordersTable");
const searchInput = document.getElementById("searchProduct");

// --- Collections ---
const productCollections = {
  bracelets: "products_bracelets",
  cookies: "products_cookies",
  spirit: "products_spirit"
};
const orderCollections = {
  bracelets: "braceletOrders",
  cookies: "cookieOrders",
  spirit: "spiritOrders"
};

// --- Tabs ---
tabs.forEach(tab=>{
  tab.addEventListener("click",()=>{
    currentCategory = tab.dataset.category;
    tabs.forEach(t=>t.classList.remove("active"));
    tab.classList.add("active");
    loadProducts();
    loadOrders();
  });
});

// --- Load Products ---
async function loadProducts(){
  productTable.innerHTML='<tr><th>ID</th><th>Name</th><th>Price</th><th>Stock</th><th>Sizes</th><th>Colors</th></tr>';
  const snap = await getDocs(collection(db, productCollections[currentCategory]));
  snap.forEach(docSnap=>{
    const data=docSnap.data();
    const row=productTable.insertRow();
    row.insertCell(0).textContent=docSnap.id;
    row.insertCell(1).textContent=data.type;
    row.insertCell(2).textContent=JSON.stringify(data.price);
    row.insertCell(3).textContent=data.stock;
    row.insertCell(4).textContent=(data.sizeOptions||[]).join(",");
    row.insertCell(5).textContent=(data.colorOptions||[]).join(",");
  });
}

// --- Search Products ---
searchInput.addEventListener("input", e=>{
  const term = e.target.value.toLowerCase();
  [...productTable.rows].forEach((row,i)=>{
    if(i===0) return;
    row.style.display = row.textContent.toLowerCase().includes(term) ? "" : "none";
  });
});

// --- Inline edit by clicking row ---
productTable.addEventListener("click", e => {
  const row = e.target.closest("tr");
  if (!row || row.rowIndex===0) return;
  productIdInput.value = row.cells[0].textContent;
  productTypeInput.value = row.cells[1].textContent;
  productPriceInput.value = row.cells[2].textContent;
  productStockInput.value = row.cells[3].textContent;
  productSizesInput.value = row.cells[4].textContent;
  productColorsInput.value = row.cells[5].textContent;
});

// --- Load Orders ---
async function loadOrders(){
  ordersTable.innerHTML='<tr><th>Category</th><th>Name</th><th>Email</th><th>Product</th><th>Size</th><th>Qty</th><th>Total</th><th>Status</th></tr>';
  for(const cat of Object.keys(orderCollections)){
    const snap = await getDocs(collection(db, orderCollections[cat]));
    snap.forEach(docSnap=>{
      const data = docSnap.data();
      const row = ordersTable.insertRow();
      row.insertCell(0).textContent = cat;
      row.insertCell(1).textContent = data.name;
      row.insertCell(2).textContent = data.email;
      row.insertCell(3).textContent = data.product;
      row.insertCell(4).textContent = data.size || "-";
      row.insertCell(5).textContent = data.qty;
      row.insertCell(6).textContent = `$${data.total.toFixed(2)}`;
      row.insertCell(7).innerHTML = `<span style="color:${data.status==='Completed'?'#0f0':'#ffb347'}">${data.status||"Pending"}</span>`;
    });
  }
}

// --- Product Actions ---
async function addOrUpdateProduct(update=false){
  try{
    const id = update ? productIdInput.value.trim() : productTypeInput.value.trim().toLowerCase().replace(/\s+/g,'-');
    if(!id) { productMsg.textContent="‚ö†Ô∏è Product ID required"; return; }
    let price = productPriceInput.value.trim();
    try { price = JSON.parse(price); } catch(e){ price = parseFloat(price);}
    await setDoc(doc(db, productCollections[currentCategory], id), {
      type: productTypeInput.value.trim(),
      price,
      stock: parseInt(productStockInput.value),
      sizeOptions: productSizesInput.value.split(",").map(s=>s.trim()).filter(s=>s),
      colorOptions: productColorsInput.value.split(",").map(c=>c.trim()).filter(c=>c)
    });
    productMsg.textContent = update ? "‚úÖ Product updated!" : "‚úÖ Product added!";
    loadProducts();
  }catch(err){ console.error(err); productMsg.textContent="‚ùå Error saving product";}
}

async function deleteProduct(){
  const id = productIdInput.value.trim();
  if(!id){productMsg.textContent="‚ö†Ô∏è Enter Product ID to delete"; return;}
  if(!confirm("‚ö†Ô∏è Are you sure you want to delete this product?")) return;
  try{
    await deleteDoc(doc(db, productCollections[currentCategory], id));
    productMsg.textContent="‚úÖ Product deleted!";
    loadProducts();
  }catch(err){console.error(err); productMsg.textContent="‚ùå Error deleting product";}
}

// --- Re-add all bracelets ---
const allBracelets = [ /* Keep your previous bracelet objects here */ ];
async function reAddAllBracelets() {
  if(!confirm("‚ö†Ô∏è This will overwrite/add all bracelet products. Continue?")) return;
  try {
    for(const b of allBracelets){
      const id = b.type.toLowerCase().replace(/\s+/g,'-');
      await setDoc(doc(db, productCollections["bracelets"], id), b);
    }
    alert("‚úÖ All bracelets re-added!");
    loadProducts();
  } catch(e) { console.error(e); alert("‚ùå Error re-adding bracelets"); }
}

// --- Event Listeners ---
document.getElementById("addProductBtn").addEventListener("click", ()=>addOrUpdateProduct(false));
document.getElementById("updateProductBtn").addEventListener("click", ()=>addOrUpdateProduct(true));
document.getElementById("deleteProductBtn").addEventListener("click", deleteProduct);
document.getElementById("reAddBraceletsBtn").addEventListener("click", reAddAllBracelets);

// --- Initialize ---
loadProducts();
loadOrders();
</script>
</body>
</html>
