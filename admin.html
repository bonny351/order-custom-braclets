<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tactics & Treats ‚Äì Admin Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
<style>
body { background: linear-gradient(135deg, #1a0000, #330000); color: #f5f5f5; font-family: 'Poppins', sans-serif; min-height: 100vh; padding: 2rem 1rem; }
h1,h2,h3 { color: #ffdddd; letter-spacing: 0.5px; }
.card { background: rgba(20,0,0,0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.08); border-radius: 1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.4); padding: 1.5rem; margin-bottom: 2rem; }
.tab-btn { cursor: pointer; padding: 10px 20px; font-weight: 600; border-radius: 12px 12px 0 0; background: rgba(128,0,0,0.5); color: #ddd; margin-right: 6px; transition: all 0.3s ease; }
.tab-btn:hover { background: rgba(255,0,0,0.35); }
.tab-btn.active { background: #ff0000; color: #fff; box-shadow: 0 3px 12px rgba(255,0,0,0.4); }
.table-container { overflow-x: auto; border-radius: 10px; }
table { width: 100%; border-collapse: collapse; font-size: 0.9rem; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; }
th { background: rgba(128,0,0,0.8); color: #fff; font-weight: 600; text-transform: uppercase; padding: 10px; }
td { background: rgba(255,255,255,0.03); padding: 8px; }
tr:hover td { background: rgba(255,0,0,0.1); }
input, select { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); color: white; padding: 6px 8px; border-radius: 6px; width: 100%; }
button { background: linear-gradient(90deg,#b00,#e00); color:white; border:none; border-radius:8px; padding:6px 12px; font-weight:600; transition: all 0.3s; }
button:hover { transform: translateY(-1px); background: linear-gradient(90deg,#e00,#ff3333); }
</style>
</head>
<body class="flex flex-col items-center">
<div class="max-w-6xl w-full">
  <h1 class="text-4xl font-bold text-center mb-10 tracking-wide text-red-400">Admin Dashboard ‚Äì Tactics & Treats</h1>

  <!-- Tabs -->
  <div class="flex justify-center mb-6">
    <div id="tabCookies" class="tab-btn active">üç™ Cookies</div>
    <div id="tabBracelets" class="tab-btn">üßµ Bracelets</div>
    <div id="tabSpirit" class="tab-btn">üëï Spirit Wear</div>
  </div>

  <!-- Products Section -->
  <section class="card">
    <h2 class="text-xl font-semibold mb-2">Products 
      <button onclick="addProduct()" class="ml-4 text-sm px-2 py-1 bg-green-600 hover:bg-green-700 rounded">+ Add Product</button>
    </h2>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Name / Type</th>
            <th>SKU</th>
            <th>Price</th>
            <th>Stock</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="productsTable">
          <tr><td colspan="5" class="text-center p-4 text-gray-400">Loading...</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Orders Section -->
  <section class="card">
    <h2 class="text-xl font-semibold mb-2">Orders</h2>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Email</th>
            <th>Product</th>
            <th>Size / Color</th>
            <th>Qty</th>
            <th>Total</th>
            <th>Address</th>
            <th>Payment</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="ordersTable">
          <tr><td colspan="11" class="text-center p-4 text-gray-400">Loading...</td></tr>
        </tbody>
      </table>
    </div>
  </section>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, deleteDoc, doc, addDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCiZuaANb1lrgdn-aARGJ_TRhgzPPUug58",
  authDomain: "bracelets-and-color.firebaseapp.com",
  projectId: "bracelets-and-color",
  storageBucket: "bracelets-and-color.appspot.com",
  messagingSenderId: "382292570673",
  appId: "1:382292570673:web:1c966e2e7e8fc2efa31b10"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentTab = "cookies";
const tabs = {
  cookies: document.getElementById("tabCookies"),
  bracelets: document.getElementById("tabBracelets"),
  spirit: document.getElementById("tabSpirit")
};

Object.entries(tabs).forEach(([key, el])=>{
  el.addEventListener("click", ()=>{
    currentTab = key;
    Object.values(tabs).forEach(t=>t.classList.remove("active"));
    el.classList.add("active");
    loadData();
  });
});

const productsTable = document.getElementById("productsTable");
const ordersTable = document.getElementById("ordersTable");

async function loadData(){
  productsTable.innerHTML = "<tr><td colspan='5' class='text-center p-4 text-gray-400'>Loading...</td></tr>";
  ordersTable.innerHTML = "<tr><td colspan='11' class='text-center p-4 text-gray-400'>Loading...</td></tr>";

  const prodCol = collection(db, `products_${currentTab}`);
  const orderCol = collection(db, `${currentTab==="spirit"?"spiritOrders":currentTab+"Orders"}`);

  const [prodSnap, orderSnap] = await Promise.all([getDocs(prodCol), getDocs(orderCol)]);
  renderProducts(prodSnap.docs);
  renderOrders(orderSnap.docs);
}

function renderProducts(docs){
  productsTable.innerHTML = docs.length? "": `<tr><td colspan='5' class='text-center text-gray-400'>No products found</td></tr>`;
  docs.forEach(docSnap=>{
    const d = docSnap.data();
    const displayName = d.name || d.productName || d.type || "Unnamed Product";
    const tr = document.createElement("tr");
    tr.innerHTML=`
      <td><input value="${displayName}" id="name-${docSnap.id}"></td>
      <td><input value="${d.sku||""}" id="sku-${docSnap.id}"></td>
      <td><input type="number" value="${d.price||0}" id="price-${docSnap.id}"></td>
      <td><input type="number" value="${d.stock??0}" id="stock-${docSnap.id}"></td>
      <td class="flex gap-2">
        <button onclick="saveProduct('${docSnap.id}')">üíæ</button>
        <button onclick="deleteProduct('${docSnap.id}')">üóëÔ∏è</button>
      </td>
    `;
    productsTable.appendChild(tr);
  });
}

function renderOrders(docs){
  ordersTable.innerHTML = docs.length? "": `<tr><td colspan='11' class='text-center text-gray-400'>No orders found</td></tr>`;
  docs.forEach((docSnap,i)=>{
    const d = docSnap.data();
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>#${i+1}</td>
      <td><input value="${d.name||''}" id="oname-${docSnap.id}"></td>
      <td><input value="${d.email||''}" id="oemail-${docSnap.id}"></td>
      <td><input value="${d.product||''}" id="oproduct-${docSnap.id}"></td>
      <td><input value="${d.size||d.color1? `${d.size||''} ${d.color1||''} ${d.color2||''}`:''}" id="osize-${docSnap.id}"></td>
      <td><input type="number" value="${d.qty||1}" id="oqty-${docSnap.id}"></td>
      <td><input type="number" value="${d.total||0}" id="ototal-${docSnap.id}"></td>
      <td><input value="${d.address||''}" id="oaddress-${docSnap.id}"></td>
      <td>
        <select id="opayment-${docSnap.id}">
          <option value="PayPal" ${d.payment==='PayPal'?'selected':''}>PayPal</option>
          <option value="Cash" ${d.payment==='Cash'?'selected':''}>Cash</option>
        </select>
      </td>
      <td>
        <select id="ostatus-${docSnap.id}">
          <option value="Pending" ${d.status==='Pending'?'selected':''}>Pending</option>
          <option value="Completed" ${d.status==='Completed'?'selected':''}>Completed</option>
          <option value="Cancelled" ${d.status==='Cancelled'?'selected':''}>Cancelled</option>
        </select>
      </td>
      <td class="flex gap-2">
        <button onclick="saveOrder('${docSnap.id}')">üíæ</button>
        <button onclick="deleteOrder('${docSnap.id}')">üóëÔ∏è</button>
      </td>
    `;
    ordersTable.appendChild(tr);
  });
}

async function saveProduct(id){
  const name = document.getElementById(`name-${id}`).value;
  const sku = document.getElementById(`sku-${id}`).value;
  const price = parseFloat(document.getElementById(`price-${id}`).value);
  const stock = parseInt(document.getElementById(`stock-${id}`).value);
  await updateDoc(doc(db, `products_${currentTab}`, id), {name, sku, price, stock});
  alert("Product updated!");
}

async function deleteProduct(id){
  if(confirm("Delete this product?")){
    await deleteDoc(doc(db, `products_${currentTab}`, id));
    loadData();
  }
}

async function addProduct(){
  const name = prompt("Product name:");
  if(!name) return;
  await addDoc(collection(db, `products_${currentTab}`), {name, sku:"", price:0, stock:0});
  loadData();
}

async function saveOrder(id){
  const name = document.getElementById(`oname-${id}`).value;
  const email = document.getElementById(`oemail-${id}`).value;
  const product = document.getElementById(`oproduct-${id}`).value;
  const size = document.getElementById(`osize-${id}`).value;
  const qty = parseInt(document.getElementById(`oqty-${id}`).value);
  const total = parseFloat(document.getElementById(`ototal-${id}`).value);
  const address = document.getElementById(`oaddress-${id}`).value;
  const payment = document.getElementById(`opayment-${id}`).value;
  const status = document.getElementById(`ostatus-${id}`).value;

  await updateDoc(doc(db, `${currentTab==="spirit"?"spiritOrders":currentTab+"Orders"}`, id), 
    {name,email,product,size,qty,total,address,payment,status});
  alert("Order updated!");
}

async function deleteOrder(id){
  if(confirm("Delete this order?")){
    await deleteDoc(doc(db, `${currentTab==="spirit"?"spiritOrders":currentTab+"Orders"}`, id));
    loadData();
  }
}

// Initial load
loadData();
</script>
</body>
</html>
