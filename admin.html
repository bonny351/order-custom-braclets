<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tactics & Treats – Admin Panel</title>

<style>
body {
  font-family:"Poppins",sans-serif;
  background:#111;
  color:white;
  margin:0;
  padding:20px;
}
h1,h2 {
  text-align:center;
  color:#ff0000;
  margin-bottom:20px;
}

header {
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:linear-gradient(90deg,#7a0c0c,#000);
  padding:10px 20px;
  border-radius:10px;
  box-shadow:0 0 12px rgba(255,0,0,0.4);
  margin-bottom:20px;
}
header img {
  height:60px;
  width:60px;
  border-radius:50%;
  border:2px solid #ff0000;
}
header h1 {
  flex:1;
  text-align:center;
  margin:0;
  color:#ff0000;
}

section {
  background:#181818;
  padding:20px;
  border-radius:12px;
  box-shadow:0 0 12px rgba(255,0,0,0.2);
  margin-bottom:30px;
  position:relative;
}

.tabs,.subTabs {
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:15px;
}

.tab,.subTab {
  padding:10px 20px;
  cursor:pointer;
  border-radius:5px;
  background:#222;
  color:white;
  font-weight:bold;
  transition:.2s;
}

.tab.active,.subTab.active {
  background:#ff0000;
  color:white;
  box-shadow:0 0 8px #ff0000;
}

table {
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td {
  padding:10px;
  border:1px solid #ff0000;
  text-align:center;
}
th {
  background:#222;
  color:#ffb347;
}
tr:nth-child(even) { background:#222; }

img.admin-thumb {
  height:70px;
  border-radius:6px;
  border:2px solid #ff0000;
}

#searchInput {
  width:100%;
  max-width:400px;
  margin:10px auto;
  display:block;
  padding:8px;
  border-radius:5px;
  border:none;
  font-size:14px;
}

.loadingOverlay {
  position:absolute;
  top:0; left:0; right:0; bottom:0;
  background:rgba(0,0,0,0.6);
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:20px;
  color:#ffb347;
  opacity:0;
  pointer-events:none;
  transition:.3s;
}
.loadingOverlay.show {
  opacity:1;
  pointer-events:auto;
}

button {
  padding:8px 12px;
  background:#ff0000;
  color:white;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
  transition:.2s;
}
button:hover {
  background:darkred;
  box-shadow:0 0 8px #ff0000;
}

</style>
</head>
<body>

<header>
  <img src="logo.png">
  <h1>Tactics & Treats – Admin Panel</h1>
</header>

<div class="tabs" id="mainTabs"></div>
<div class="subTabs" id="subTabs"></div>

<section>
  <h2 id="tableTitle">Loading...</h2>
  <input type="text" id="searchInput" placeholder="Search...">
  <p id="tableMsg"></p>

  <div class="loadingOverlay" id="loadOverlay">Loading...</div>

  <table id="dataTable"></table>

</section>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import {
  getFirestore, collection, getDocs, doc, getDoc, setDoc, deleteDoc
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyCiZuaANb1lrgdn-aARGJ_TRhgzPPUug58",
  authDomain:"bracelets-and-color.firebaseapp.com",
  projectId:"bracelets-and-color",
  storageBucket:"bracelets-and-color.appspot.com",
  messagingSenderId:"382292570673",
  appId:"1:382292570673:web:1c966e2e7e8fc2efa31b10"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const GH_RAW = ""; // OPTIONAL: if your site is hosted by GitHub Pages, relative paths work already.

const mainTabs = document.getElementById("mainTabs");
const subTabs = document.getElementById("subTabs");
const tableTitle = document.getElementById("tableTitle");
const tableMsg = document.getElementById("tableMsg");
const table = document.getElementById("dataTable");
const overlay = document.getElementById("loadOverlay");

const collections = {
  "Products": ["products", "products_bracelets", "products_cookies", "products_spirit"],
  "Orders": ["braceletOrders", "cookieOrders", "spiritOrders"],
  "Users": ["users"],
  "Settings": ["siteSettings"]
};

let currentCategory = "";
let currentCollection = "";

/* Create main tabs */
Object.keys(collections).forEach(cat => {
  const t = document.createElement("div");
  t.className = "tab";
  t.textContent = cat;
  t.onclick = () => {
    [...mainTabs.children].forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    currentCategory = cat;
    loadSubTabs();
  };
  mainTabs.appendChild(t);
});
mainTabs.children[0].click();

/* Load Sub Tabs */
function loadSubTabs() {
  subTabs.innerHTML = "";
  collections[currentCategory].forEach(col => {
    const st = document.createElement("div");
    st.className = "subTab";
    st.textContent = col;

    st.onclick = () => {
      [...subTabs.children].forEach(x=>x.classList.remove("active"));
      st.classList.add("active");
      currentCollection = col;
      loadTable();
    };

    subTabs.appendChild(st);
  });
  subTabs.children[0].click();
}

/* Bracelet image loader */
function braceletImage(name, side=0) {
  if (!name) return "default.png";

  const key = name.toLowerCase().replace(/ /g,"-");
  return side === 0 
      ? `${key}-main.png`
      : `${key}-side${side}.png`;
}

/* Render custom bracelet row */
function renderBraceletRow(row, data, id) {
  const fields = [
    "name","phone","email","type","size",
    "color1","color2","clipType","clipColor",
    "qty","delivery","address"
  ];

  // IMAGES (5 previews)
  const imgCell = row.insertCell();
  imgCell.innerHTML = `
    <img class="admin-thumb" src="${braceletImage(data.type,0)}">
    <img class="admin-thumb" src="${braceletImage(data.type,1)}">
    <img class="admin-thumb" src="${braceletImage(data.type,2)}">
    <img class="admin-thumb" src="${braceletImage(data.type,3)}">
    <img class="admin-thumb" src="${braceletImage(data.type,4)}">
  `;

  // Editable fields
  fields.forEach(f => {
    const cell = row.insertCell();
    cell.textContent = data[f] ?? "";
    cell.contentEditable = true;

    cell.onblur = async () => {
      const v = cell.textContent.trim();
      try {
        await setDoc(doc(db,currentCollection,id),{
          ...data, [f]: v
        });
        tableMsg.textContent = `✔ Updated ${f}`;
      } catch {
        tableMsg.textContent = "❌ Update failed";
      }
    };
  });
}

/* Load Table */
async function loadTable() {
  overlay.classList.add("show");
  table.innerHTML = "";
  tableTitle.textContent = currentCollection;

  const snap = await getDocs(collection(db,currentCollection));
  const rows = snap.docs;

  if (currentCollection === "braceletOrders") {
    // Custom bracelet header
    const h = table.insertRow();
    [
      "Images","Name","Phone","Email","Type","Size",
      "Color1","Color2","ClipType","ClipColor",
      "Qty","Delivery","Address"
    ].forEach(t=>{
      const th=document.createElement("th");
      th.textContent=t;
      h.appendChild(th);
    });

    rows.forEach(docSnap=>{
      const r = table.insertRow();
      renderBraceletRow(r, docSnap.data(), docSnap.id);
    });

    overlay.classList.remove("show");
    return;
  }

  // Generic tables
  const allKeys = new Set();
  rows.forEach(d=> Object.keys(d.data()).forEach(k=>allKeys.add(k)));
  const keys = [...allKeys];

  const header = table.insertRow();
  header.insertCell().textContent = "ID";
  keys.forEach(k=>{
    const th=document.createElement("th");
    th.textContent=k;
    header.appendChild(th);
  });

  rows.forEach(docSnap=>{
    const r = table.insertRow();
    r.insertCell().textContent = docSnap.id;
    const data = docSnap.data();

    keys.forEach(k=>{
      const c = r.insertCell();
      c.textContent = typeof data[k] === "object" 
        ? JSON.stringify(data[k]) 
        : data[k];

      c.contentEditable = true;
      c.onblur = async ()=>{
        let v = c.textContent.trim();
        try {
          await setDoc(doc(db,currentCollection,docSnap.id),{
            ...data,[k]:v
          });
          tableMsg.textContent=`✔ Updated ${k}`;
        } catch {
          tableMsg.textContent="❌ Update failed";
        }
      };
    });
  });

  overlay.classList.remove("show");
}

</script>

</body>
</html>
