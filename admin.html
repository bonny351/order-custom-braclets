<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tactics & Treats Admin</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: 'Poppins', sans-serif; background: #111; color: white; padding: 20px; }
  nav a { margin-right: 15px; font-weight: bold; text-decoration: none; color: #fff; }
  nav a.active { text-decoration: underline; color: #ff0000; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #444; padding: 8px; text-align: left; }
  th { background: #222; }
  input, select { width: 100%; background: #222; color: white; border: 1px solid #555; border-radius: 4px; padding: 4px; }
  button { background: #ff0000; color: white; padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; margin-right: 4px; }
</style>
</head>
<body>

<nav>
  <a href="#" id="tabCookies" class="active">Cookies</a>
  <a href="#" id="tabBracelets">Bracelets</a>
  <a href="#" id="tabSpirit">Spirit Wear</a>
</nav>

<section class="card mt-4">
  <h2 class="text-xl font-semibold mb-2">Products</h2>
  <div class="table-container overflow-auto">
    <table>
      <thead>
        <tr>
          <th>Name / Type</th>
          <th>SKU</th>
          <th>Price</th>
          <th>Stock</th>
          <th>Supplier</th>
          <th>Sizes</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="productsTable">
        <tr><td colspan="7" class="text-center p-4 text-gray-400">Loading...</td></tr>
      </tbody>
    </table>
  </div>
  <button class="mt-4" onclick="addProduct()">‚ûï Add Product</button>
</section>

<section class="card mt-6">
  <h2 class="text-xl font-semibold mb-2">Orders</h2>
  <div class="table-container overflow-auto">
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Product</th>
          <th>Quantity</th>
          <th>Size / Color</th>
          <th>Address</th>
          <th>State</th>
          <th>Payment</th>
          <th>Status</th>
          <th>Created At</th>
        </tr>
      </thead>
      <tbody id="ordersTable">
        <tr><td colspan="10" class="text-center p-4 text-gray-400">Loading...</td></tr>
      </tbody>
    </table>
  </div>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc, deleteDoc, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCiZuaANb1lrgdn-aARGJ_TRhgzPPUug58",
  authDomain: "bracelets-and-color.firebaseapp.com",
  projectId: "bracelets-and-color",
  storageBucket: "bracelets-and-color.appspot.com",
  messagingSenderId: "382292570673",
  appId: "1:382292570673:web:1c966e2e7e8fc2efa31b10"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentTab = "cookies";
const tabs = {
  cookies: document.getElementById("tabCookies"),
  bracelets: document.getElementById("tabBracelets"),
  spirit: document.getElementById("tabSpirit")
};

Object.entries(tabs).forEach(([key, el]) => {
  el.addEventListener("click", () => {
    currentTab = key;
    Object.values(tabs).forEach(t => t.classList.remove("active"));
    el.classList.add("active");
    loadProducts();
  });
});

const productsTable = document.getElementById("productsTable");
const ordersTable = document.getElementById("ordersTable");

async function loadProducts() {
  const prodCol = collection(db, `products_${currentTab}`);
  const prodSnap = await getDocs(prodCol);
  
  productsTable.innerHTML = prodSnap.docs.length ? "" : `<tr><td colspan='7' class='text-center text-gray-400'>No products found</td></tr>`;
  
  prodSnap.docs.forEach(docSnap => {
    const d = docSnap.data();
    const tr = document.createElement("tr");
    const sizes = Array.isArray(d.sizes) ? d.sizes.join(", ") : "";

    tr.innerHTML = `
      <td><input value="${d.name || d.productName || d.type || ""}" id="name-${docSnap.id}"></td>
      <td><input value="${d.sku || ""}" id="sku-${docSnap.id}"></td>
      <td><input type="number" value="${d.price || 0}" id="price-${docSnap.id}"></td>
      <td><input type="number" value="${d.stock ?? 0}" id="stock-${docSnap.id}"></td>
      <td><input value="${d.supplier || ""}" id="supplier-${docSnap.id}"></td>
      <td><input value="${sizes}" id="sizes-${docSnap.id}" placeholder="Comma-separated"></td>
      <td class="flex gap-2">
        <button onclick="saveProduct('${docSnap.id}')">üíæ</button>
        <button onclick="deleteProduct('${docSnap.id}')">üóëÔ∏è</button>
      </td>
    `;
    productsTable.appendChild(tr);
  });
}

window.saveProduct = async id => {
  const ref = doc(db, `products_${currentTab}`, id);
  const sizesInput = document.getElementById(`sizes-${id}`).value.trim();
  const sizesArray = sizesInput ? sizesInput.split(",").map(s => s.trim()) : [];

  await updateDoc(ref, {
    name: document.getElementById(`name-${id}`).value.trim(),
    sku: document.getElementById(`sku-${id}`).value.trim(),
    price: parseFloat(document.getElementById(`price-${id}`).value) || 0,
    stock: parseInt(document.getElementById(`stock-${id}`).value) || 0,
    supplier: document.getElementById(`supplier-${id}`).value.trim(),
    sizes: sizesArray
  });
  alert("‚úÖ Product saved!");
};

window.deleteProduct = async id => {
  await deleteDoc(doc(db, `products_${currentTab}`, id));
  loadProducts();
};

window.addProduct = async () => {
  await addDoc(collection(db, `products_${currentTab}`), {
    name: "New Product",
    sku: "",
    price: 0,
    stock: 0,
    supplier: "",
    sizes: []
  });
  loadProducts();
};

async function loadOrders() {
  const ordersCol = collection(db, "allOrders");
  const ordersSnap = await getDocs(ordersCol);
  
  ordersTable.innerHTML = ordersSnap.docs.length ? "" : `<tr><td colspan='10' class='text-center text-gray-400'>No orders found</td></tr>`;

  ordersSnap.docs.forEach(docSnap => {
    const d = docSnap.data();
    const createdAt = d.createdAt?.toDate ? d.createdAt.toDate().toLocaleString() : "";
    ordersTable.innerHTML += `
      <tr>
        <td>${d.name || ""}</td>
        <td>${d.email || ""}</td>
        <td>${d.product || ""}</td>
        <td>${d.quantity || 1}</td>
        <td>${d.size || d.color1 ? d.size || d.color1 + " / " + d.color2 : ""}</td>
        <td>${d.address || ""}</td>
        <td>${d.state || ""}</td>
        <td>${d.paymentMethod || ""}</td>
        <td>${d.status || ""}</td>
        <td>${createdAt}</td>
      </tr>
    `;
  });
}

// Initial load
loadProducts();
loadOrders();

</script>
</body>
</html>
