<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Dashboard | Tactics & Treats</title>

<style>
  body {font-family:'Poppins',sans-serif;background:black;color:white;margin:0;padding:0;}
  header {background:linear-gradient(90deg,#ff0040,#ff6600);padding:15px;text-align:center;font-size:1.4em;font-weight:600;}
  h2 {border-left:5px solid #ff0040;padding-left:10px;}
  table {width:100%;border-collapse:collapse;background:#111;margin-top:10px;}
  th,td {border:1px solid #222;padding:8px;text-align:center;}
  th {background:#111;color:#ff0040;}
  tr:nth-child(even){background:#0a0a0a;}
  button {background:#ff0040;color:white;border:none;border-radius:8px;padding:8px 15px;margin:5px;cursor:pointer;}
  button:hover{background:#ff3366;transform:scale(1.05);}
  #adminOverlay {position:fixed;inset:0;background:rgba(0,0,0,0.9);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:2000;}
  #adminOverlay input{padding:10px;font-size:1.1em;border:1px solid #ff0040;border-radius:8px;background:#111;color:white;text-align:center;}
  #adminOverlay button{margin-top:10px;background:#ff0040;padding:8px 18px;border-radius:8px;font-weight:600;}
  #productModal {display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);backdrop-filter:blur(5px);justify-content:center;align-items:center;z-index:1000;}
  #productModal.show{display:flex;}
  .modal-content{background:#111;padding:20px;border-radius:12px;width:350px;box-shadow:0 0 20px #ff0040;}
  .modal-content input,.modal-content select{width:100%;padding:8px;margin:5px 0;border-radius:6px;border:1px solid #333;background:#0a0a0a;color:white;}
  .modal-buttons{display:flex;justify-content:space-between;margin-top:10px;}
</style>
</head>

<body>
<div id="adminOverlay">
  <h2>Enter Admin Code</h2>
  <input type="password" id="adminCodeInput" placeholder="Enter code" />
  <button id="submitCode">Access Dashboard</button>
  <p id="codeError" style="color:#ff0040;display:none;">‚ùå Incorrect Code</p>
</div>

<header>üõ†Ô∏è Admin Dashboard | Tactics & Treats</header>

<main style="display:none;" id="adminMain">
  <h2>Products</h2>
  <button id="addProduct">‚ûï Add Product</button>
  <table>
    <thead>
      <tr>
        <th>Name</th><th>Type</th><th>Size</th><th>Price</th><th>Stock</th><th>Supplier</th>
      </tr>
    </thead>
    <tbody id="productBody"></tbody>
  </table>
</main>

<div id="productModal">
  <div class="modal-content">
    <h3>Add Product</h3>
    <label>Product Type</label>
    <select id="productType">
      <option value="cookie">Cookie</option>
      <option value="bracelet">Bracelet</option>
    </select>
    <label>Name</label>
    <input id="productName" type="text" placeholder="Product name">
    <label>Size (Bracelet only)</label>
    <input id="productSize" type="text" placeholder="e.g. Small, Medium">
    <label>Price</label>
    <input id="productPrice" type="number" step="0.01" value="5.00">
    <label>Stock</label>
    <input id="productStock" type="number" value="10">
    <label>Supplier</label>
    <input id="productSupplier" type="text" placeholder="Supplier name">
    <div class="modal-buttons">
      <button id="saveProduct">üíæ Save</button>
      <button id="closeModal">‚ùå Cancel</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCiZuaANb1lrgdn-aARGJ_TRhgzPPUug58",
  authDomain: "bracelets-and-color.firebaseapp.com",
  projectId: "bracelets-and-color",
  storageBucket: "bracelets-and-color.appspot.com",
  messagingSenderId: "382292570673",
  appId: "1:382292570673:web:1c966e2e7e8fc2efa31b10"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ==== ADMIN CODE LOGIN ====
const ADMIN_CODE = "20903";
const overlay = document.getElementById("adminOverlay");
const adminMain = document.getElementById("adminMain");
const submitCode = document.getElementById("submitCode");
const adminCodeInput = document.getElementById("adminCodeInput");
const codeError = document.getElementById("codeError");

submitCode.addEventListener("click", () => {
  if (adminCodeInput.value === ADMIN_CODE) {
    overlay.style.display = "none";
    adminMain.style.display = "block";
    loadProducts();
  } else {
    codeError.style.display = "block";
    adminCodeInput.value = "";
  }
});

// ==== LOAD PRODUCTS ====
async function loadProducts() {
  const productBody = document.getElementById("productBody");
  productBody.innerHTML = "";

  const cookieSnap = await getDocs(collection(db, "cookies"));
  const braceletSnap = await getDocs(collection(db, "bracelets"));

  cookieSnap.forEach(docSnap => {
    const p = docSnap.data();
    productBody.innerHTML += `<tr>
      <td>${p.name || "Unnamed"}</td>
      <td>Cookie</td>
      <td>-</td>
      <td>$${p.price || 0}</td>
      <td>${p.stock || 0}</td>
      <td>${p.supplier || "-"}</td>
    </tr>`;
  });

  braceletSnap.forEach(docSnap => {
    const p = docSnap.data();
    productBody.innerHTML += `<tr>
      <td>${p.name || "Unnamed"}</td>
      <td>Bracelet</td>
      <td>${p.size || "-"}</td>
      <td>$${p.price || 0}</td>
      <td>${p.stock || 0}</td>
      <td>${p.supplier || "-"}</td>
    </tr>`;
  });
}

// ==== ADD PRODUCT ====
const addProductBtn = document.getElementById("addProduct");
const productModal = document.getElementById("productModal");
const saveProductBtn = document.getElementById("saveProduct");
const closeModalBtn = document.getElementById("closeModal");

addProductBtn.onclick = () => productModal.classList.add("show");
closeModalBtn.onclick = () => productModal.classList.remove("show");

saveProductBtn.onclick = async () => {
  const type = document.getElementById("productType").value;
  const name = document.getElementById("productName").value.trim();
  const size = document.getElementById("productSize").value.trim();
  const price = parseFloat(document.getElementById("productPrice").value);
  const stock = parseInt(document.getElementById("productStock").value);
  const supplier = document.getElementById("productSupplier").value.trim();

  if (!name) {
    alert("Enter a product name.");
    return;
  }

  const productData = { name, price, stock, supplier };
  if (type === "bracelet") productData.size = size;

  try {
    await addDoc(collection(db, type === "cookie" ? "cookies" : "bracelets"), productData);
    alert("‚úÖ Product added!");
    productModal.classList.remove("show");
    loadProducts();
  } catch (err) {
    alert("‚ùå Error adding product: " + err.message);
  }
};
</script>
</body>
</html>

