<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tactics & Treats ‚Äì Preorder</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
<style>
  /* Background + logo overlay */
  body {
    background: linear-gradient(to right, #8b0000 0%, #000 50%, #8b0000 100%);
    background-attachment: fixed;
    min-height: 100vh;
  }
  .paw-overlay {
    background-image: url('your-logo.png');
    background-repeat: repeat;
    background-size: 120px;
    opacity: 0.05;
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none;
    z-index: 0;
  }
  main, header, footer { position: relative; z-index: 10; }
  .tab-btn {
    cursor: pointer;
    padding: 8px 16px;
    font-weight: 700;
    border-radius: 10px 10px 0 0;
    background: #800000;
    color: white;
    margin-right: 6px;
    transition: 200ms;
  }
  .tab-btn.active { background: #ff0000; }
</style>
</head>
<body class="flex flex-col items-center py-10">
  <div class="paw-overlay"></div>

  <header class="w-full text-center mb-8">
    <img src="your-logo.png" alt="Tactics & Treats Logo" class="mx-auto w-36 h-auto mb-4" />
    <h1 class="text-3xl font-bold text-white drop-shadow-lg">Tactics & Treats</h1>
    <p class="text-gray-200">Preorder Cookies & Bracelets</p>
  </header>

  <main class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-md space-y-6">
    <div class="flex justify-center mb-6">
      <button id="tabCookies" class="tab-btn active">üç™ Cookies</button>
      <button id="tabBracelets" class="tab-btn">üßµ Bracelets</button>
    </div>

    <!-- Cookies Tab -->
    <div id="cookiesTab" class="">
      <h2 class="text-2xl font-semibold mb-4 text-center text-red-700">Cookie Preorder</h2>
      <form id="cookieForm" class="space-y-4">
        <input id="nameC" type="text" placeholder="Your Name" class="w-full border p-2 rounded" required />
        <input id="emailC" type="email" placeholder="Your Email" class="w-full border p-2 rounded" required />
        <select id="cookieType" class="w-full border p-2 rounded" required>
          <option>Loading cookies‚Ä¶</option>
        </select>
        <input id="cookieQty" type="number" min="1" placeholder="Quantity" class="w-full border p-2 rounded" required />
        <p id="cookiePrice" class="text-center font-bold mt-2">Total: $0.00</p>
        <button type="submit" class="w-full bg-red-700 text-white py-2 rounded hover:bg-red-800 transition">Submit Order</button>

        <!-- Find Order button -->
        <a href="orderlookup.html"
           class="block text-center w-full bg-gradient-to-r from-red-700 to-black text-white py-2 rounded hover:opacity-90 transition">
          üîç Find My Order
        </a>
      </form>
    </div>

    <!-- Bracelets Tab -->
    <div id="braceletsTab" class="hidden">
      <h2 class="text-2xl font-semibold mb-4 text-center text-red-700">Bracelet Preorder</h2>
      <form id="braceletForm" class="space-y-4">
        <input id="nameB" type="text" placeholder="Your Name" class="w-full border p-2 rounded" required />
        <input id="emailB" type="email" placeholder="Your Email" class="w-full border p-2 rounded" required />

        <select id="braceletType" class="w-full border p-2 rounded" required>
          <option>Loading types‚Ä¶</option>
        </select>

        <select id="braceletSize" class="w-full border p-2 rounded" required>
          <option>Loading sizes‚Ä¶</option>
        </select>

        <select id="color1" class="w-full border p-2 rounded" required>
          <option>Loading colors‚Ä¶</option>
        </select>

        <select id="color2" class="w-full border p-2 rounded">
          <option value="">Accent color (optional)</option>
        </select>

        <input id="extrasCount" type="number" min="0" placeholder="Extras (optional)" class="w-full border p-2 rounded" />

        <p id="braceletPrice" class="text-center font-bold mt-2">Price: $0.00</p>
        <button type="submit" class="w-full bg-red-700 text-white py-2 rounded hover:bg-red-800 transition">Submit Order</button>

        <!-- Find Order button -->
        <a href="orderlookup.html"
           class="block text-center w-full bg-gradient-to-r from-red-700 to-black text-white py-2 rounded hover:opacity-90 transition">
          üîç Find My Order
        </a>
      </form>
    </div>

    <p id="status" class="text-center font-semibold mt-3"></p>
  </main>

  <footer class="mt-8 text-gray-300 text-sm text-center">¬© 2025 Tactics & Treats ‚Ä¢ Handmade with ‚ù§Ô∏è</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCiZuaANb1lrgdn-aARGJ_TRhgzPPUug58",
  authDomain: "bracelets-and-color.firebaseapp.com",
  projectId: "bracelets-and-color",
  storageBucket: "bracelets-and-color.appspot.com",
  messagingSenderId: "382292570673",
  appId: "1:382292570673:web:1c966e2e7e8fc2efa31b10"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// UI refs
const tabCookiesBtn = document.getElementById('tabCookies');
const tabBraceletsBtn = document.getElementById('tabBracelets');
const cookiesTab = document.getElementById('cookiesTab');
const braceletsTab = document.getElementById('braceletsTab');
const statusEl = document.getElementById('status');

// Cookie elements
const cookieType = document.getElementById('cookieType');
const cookieQty = document.getElementById('cookieQty');
const cookiePriceEl = document.getElementById('cookiePrice');
let cookiePrices = {};

// Bracelet elements
const braceletType = document.getElementById('braceletType');
const braceletSize = document.getElementById('braceletSize');
const color1 = document.getElementById('color1');
const color2 = document.getElementById('color2');
const extrasCount = document.getElementById('extrasCount');
const braceletPriceEl = document.getElementById('braceletPrice');
let braceletData = {};
let allTypes = new Set();

// Tabs
tabCookiesBtn.onclick = () => { 
  tabCookiesBtn.classList.add('active'); 
  tabBraceletsBtn.classList.remove('active'); 
  cookiesTab.classList.remove('hidden'); 
  braceletsTab.classList.add('hidden'); 
  statusEl.textContent = ''; 
};
tabBraceletsBtn.onclick = () => { 
  tabBraceletsBtn.classList.add('active'); 
  tabCookiesBtn.classList.remove('active'); 
  braceletsTab.classList.remove('hidden'); 
  cookiesTab.classList.add('hidden'); 
  statusEl.textContent = ''; 
};

// load from Firestore
async function loadCookies() {
  cookieType.innerHTML = '<option>Loading cookies‚Ä¶</option>';
  const snap = await getDocs(collection(db, "products_cookies"));
  cookieType.innerHTML = '<option value="">Select Cookie</option>';
  snap.forEach(d => {
    const { name, price } = d.data();
    cookiePrices[name] = price;
    cookieType.appendChild(new Option(`${name} ‚Äî $${Number(price).toFixed(2)}`, name));
  });
}

async function loadBracelets() {
  const snap = await getDocs(collection(db, "products_bracelets"));
  braceletData = {};
  allTypes = new Set();
  snap.forEach(d => {
    const { size, type, price } = d.data();
    const s = String(size);
    if (!braceletData[s]) braceletData[s] = {};
    braceletData[s][type] = price;
    allTypes.add(type);
  });

  braceletType.innerHTML = '<option value="">Select Type</option>';
  Array.from(allTypes).sort().forEach(t => braceletType.appendChild(new Option(t, t)));

  const sizes = Object.keys(braceletData).map(Number).sort((a,b)=>a-b);
  braceletSize.innerHTML = '<option value="">Select Size</option>';
  sizes.forEach(s => braceletSize.appendChild(new Option(`${s}"`, String(s))));
}

// ‚úÖ Fixed: load from "colors" collection
async function loadColors() {
  color1.innerHTML = '<option value="">Loading colors‚Ä¶</option>';
  color2.innerHTML = '<option value="">Accent color (optional)</option>';
  const snap = await getDocs(collection(db, "colors"));
  color1.innerHTML = '<option value="">Select Primary Color</option>';
  snap.forEach(d => {
    const { name } = d.data();
    color1.appendChild(new Option(name, name));
    color2.appendChild(new Option(name, name));
  });
}

// price calculation
function updateCookieTotal() {
  const type = cookieType.value;
  const qty = parseInt(cookieQty.value) || 0;
  const unit = cookiePrices[type] || 0;
  const total = unit * qty;
  cookiePriceEl.textContent = `Total: $${Number(total).toFixed(2)}`;
  return total;
}

function updateBraceletPrice() {
  const type = braceletType.value;
  const size = braceletSize.value;
  const extras = parseInt(extrasCount.value) || 0;
  const base = (braceletData[size] && braceletData[size][type]) || 0;
  const total = base + extras * 1;
  braceletPriceEl.textContent = `Price: $${Number(total).toFixed(2)}`;
  return total;
}

// event handlers
cookieType.onchange = updateCookieTotal;
cookieQty.oninput = updateCookieTotal;

braceletType.onchange = () => {
  const selType = braceletType.value;
  const sizes = Object.keys(braceletData)
    .filter(sz => (selType ? (braceletData[sz] && braceletData[sz][selType]) : true))
    .map(Number).sort((a,b)=>a-b);

  braceletSize.innerHTML = '<option value="">Select Size</option>';
  sizes.forEach(s => braceletSize.appendChild(new Option(`${s}"`, String(s))));
  updateBraceletPrice();
};
braceletSize.onchange = updateBraceletPrice;
extrasCount.oninput = updateBraceletPrice;

// submit handlers
document.getElementById('cookieForm').onsubmit = async (e) => {
  e.preventDefault();
  const total = updateCookieTotal();
  await addDoc(collection(db, "cookieOrders"), {
    name: document.getElementById('nameC').value,
    email: document.getElementById('emailC').value,
    type: cookieType.value,
    quantity: parseInt(cookieQty.value),
    totalPrice: Number(total),
    status: "Pending",
    createdAt: new Date()
  });
  statusEl.textContent = "‚úÖ Cookie order submitted!";
  e.target.reset();
  cookiePriceEl.textContent = 'Total: $0.00';
};

document.getElementById('braceletForm').onsubmit = async (e) => {
  e.preventDefault();
  const total = updateBraceletPrice();
  await addDoc(collection(db, "braceletOrders"), {
    name: document.getElementById('nameB').value,
    email: document.getElementById('emailB').value,
    type: braceletType.value,
    size: Number(braceletSize.value),
    color1: color1.value,
    color2: color2.value || null,
    extras: parseInt(extrasCount.value) || 0,
    totalPrice: Number(total),
    status: "Pending",
    createdAt: new Date()
  });
  statusEl.textContent = "‚úÖ Bracelet order submitted!";
  e.target.reset();
  braceletPriceEl.textContent = 'Price: $0.00';
};

// initialize
document.addEventListener('DOMContentLoaded', async () => {
  await loadCookies();
  await loadBracelets();
  await loadColors();
});
</script>
</body>
</html>
