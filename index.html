<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tactics & Treats ‚Äì Preorder</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />

<style>
body {
  background: linear-gradient(to right, #8b0000 0%, #000 50%, #8b0000 100%);
  background-attachment: fixed;
}
.paw-overlay {
  background-image: url('your-logo.png');
  background-repeat: repeat;
  background-size: 100px;
  opacity: 0.05;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 0;
}
main, header, footer { position: relative; z-index: 10; }
.tab-btn {
  cursor: pointer;
  padding: 10px 20px;
  font-weight: bold;
  border-radius: 10px 10px 0 0;
  background: #800000;
  color: white;
  margin-right: 5px;
  transition: 0.3s;
}
.tab-btn.active { background: #ff0000; }
.tab-content { display: none; }
.tab-content.active { display: block; }
</style>
</head>

<body class="min-h-screen flex flex-col items-center py-10 relative">
<div class="paw-overlay"></div>

<header class="w-full text-center mb-8">
  <img src="your-logo.png" alt="Tactics & Treats Logo" class="mx-auto w-40 h-auto mb-4" />
  <h1 class="text-3xl font-bold text-white drop-shadow-lg">Tactics & Treats</h1>
  <p class="text-gray-200">Preorder Cookies & Bracelets</p>
</header>

<main class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-md space-y-6">

  <!-- Tabs -->
  <div class="flex justify-center mb-6">
    <div id="tabCookies" class="tab-btn active">üç™ Cookies</div>
    <div id="tabBracelets" class="tab-btn">üßµ Bracelets</div>
  </div>

  <!-- COOKIE FORM -->
  <div id="cookiesTab" class="tab-content active">
    <h2 class="text-2xl font-semibold mb-4 text-center text-red-700">Cookie Preorder</h2>
    <form id="cookieForm" class="space-y-4">
      <input id="nameC" type="text" placeholder="Your Name" class="w-full border p-2 rounded" required />
      <input id="emailC" type="email" placeholder="Your Email" class="w-full border p-2 rounded" required />
      <select id="cookieType" class="w-full border p-2 rounded"><option value="">Select Cookie</option></select>
      <input id="cookieQty" type="number" min="1" placeholder="Quantity" class="w-full border p-2 rounded" required />
      <textarea id="cookieNotes" rows="2" placeholder="Notes (optional)" class="w-full border p-2 rounded"></textarea>
      <p id="cookiePrice" class="text-center font-bold mt-2">Total: $0.00</p>
      <button type="button" onclick="submitCookieOrder()" class="w-full bg-red-600 text-white py-2 rounded-lg font-semibold hover:bg-red-700 transition">Submit Cookie Order</button>
    </form>
  </div>

  <!-- BRACELET FORM -->
  <div id="braceletsTab" class="tab-content">
    <h2 class="text-2xl font-semibold mb-4 text-center text-red-700">Bracelet Preorder</h2>
    <form id="braceletForm" class="space-y-4">
      <input id="nameB" type="text" placeholder="Your Name" class="w-full border p-2 rounded" required />
      <input id="emailB" type="email" placeholder="Your Email" class="w-full border p-2 rounded" required />
      <select id="color1" class="w-full border p-2 rounded"></select>
      <select id="color2" class="w-full border p-2 rounded"></select>
      <select id="itemType" class="w-full border p-2 rounded">
        <option value="">Choose Type</option>
        <option value="Cobra">Cobra</option>
        <option value="King Cobra">King Cobra</option>
        <option value="Fishtail">Fishtail</option>
        <option value="Solomon/Trilobite">Solomon/Trilobite</option>
      </select>
      <select id="itemSize" class="w-full border p-2 rounded"><option value="">Choose Size (inches)</option></select>
      <input id="extrasCount" type="number" min="0" placeholder="Number of Extras (optional)" class="w-full border p-2 rounded" />
      <textarea id="extrasDesc" rows="2" placeholder="Describe extras if any" class="w-full border p-2 rounded"></textarea>
      <textarea id="braceletNotes" rows="2" placeholder="Notes (optional)" class="w-full border p-2 rounded"></textarea>
      <p id="braceletPrice" class="text-center font-bold mt-2">Price: $0.00</p>
      <button type="button" onclick="submitBraceletOrder()" class="w-full bg-red-600 text-white py-2 rounded-lg font-semibold hover:bg-red-700 transition">Submit Bracelet Order</button>
    </form>
  </div>

  <p id="status" class="text-center mt-3"></p>
</main>

<footer class="mt-8 text-gray-300 text-sm text-center">
  ¬© 2025 Tactics & Treats ‚Ä¢ Handmade with ‚ù§Ô∏è
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, serverTimestamp, query, where } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCiZuaANb1lrgdn-aARGJ_TRhgzPPUug58",
  authDomain: "bracelets-and-color.firebaseapp.com",
  projectId: "bracelets-and-color",
  storageBucket: "bracelets-and-color.firebasestorage.app",
  messagingSenderId: "382292570673",
  appId: "1:382292570673:web:1c966e2e7e8fc2efa31b10",
  measurementId: "G-BJPQN6S7YB"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ===== COOKIE SETUP =====
const cookiePrices = {
  "Chocolate Chip": 1.00, "Seasonal Cookie": 1.50,
  "White Chocolate": 1.00, "Frosted Cookies": 0.50,
  "Snickerdoodle": 1.00, "Oatmeal Raisin": 1.00,
  "M&M Cookie": 1.50
};

window.addEventListener("DOMContentLoaded", async () => {
  const cookieSelect = document.getElementById("cookieType");
  const cookieQty = document.getElementById("cookieQty");
  const cookiePrice = document.getElementById("cookiePrice");
  const status = document.getElementById("status");

  Object.keys(cookiePrices).forEach(name => {
    const opt = document.createElement("option");
    opt.value = name; opt.textContent = name;
    cookieSelect.appendChild(opt);
  });

  cookieSelect.addEventListener("change", updateCookiePrice);
  cookieQty.addEventListener("input", updateCookiePrice);

  function updateCookiePrice() {
    const type = cookieSelect.value;
    const qty = parseInt(cookieQty.value) || 0;
    cookiePrice.textContent = `Total: $${((cookiePrices[type] || 0) * qty).toFixed(2)}`;
  }

  window.submitCookieOrder = async () => {
    const name = document.getElementById("nameC").value.trim();
    const email = document.getElementById("emailC").value.trim();
    const type = cookieSelect.value;
    const qty = parseInt(cookieQty.value) || 0;
    const notes = document.getElementById("cookieNotes").value.trim();

    if (!name || !email || !type || qty <= 0) {
      status.textContent = "‚ö†Ô∏è Fill all cookie fields!";
      status.className = "text-red-600 mt-2";
      return;
    }

    try {
      await addDoc(collection(db, "cookieOrders"), {
        name, email, type, quantity: qty,
        totalPrice: cookiePrices[type]*qty, notes,
        createdAt: serverTimestamp()
      });
      status.textContent = `‚úÖ Cookie order submitted! $${(cookiePrices[type]*qty).toFixed(2)}`;
      status.className = "text-green-600 mt-2";
      document.getElementById("cookieForm").reset();
      cookiePrice.textContent = "Total: $0.00";
    } catch(e) {
      console.error(e);
      status.textContent = "‚ùå Error submitting cookie order";
      status.className = "text-red-600 mt-2";
    }
  }

  // ===== BRACELET SETUP =====
  const pricing = {
    "5": { "Cobra": 4.00, "King Cobra": 5.25, "Fishtail": 3.75, "Solomon/Trilobite": 4.25 },
    "6": { "Cobra": 4.75, "King Cobra": 6.25, "Fishtail": 4.50, "Solomon/Trilobite": 5.00 },
    "7": { "Cobra": 5.50, "King Cobra": 7.25, "Fishtail": 5.25, "Solomon/Trilobite": 6.00 },
    // ... add other sizes if needed
  };

  const color1Select = document.getElementById("color1");
  const color2Select = document.getElementById("color2");
  const typeSelect = document.getElementById("itemType");
  const sizeSelect = document.getElementById("itemSize");
  const extrasCountInput = document.getElementById("extrasCount");
  const braceletPrice = document.getElementById("braceletPrice");

  // Populate sizes
  for (let i = 5; i <= 30; i++) {
    const opt = document.createElement("option");
    opt.value = i; opt.textContent = `${i}"`; sizeSelect.appendChild(opt);
  }

  async function loadColors() {
    const snapshot = await getDocs(collection(db, "braceletColors"));
    const colors = snapshot.docs.map(doc => doc.data().name);
    [color1Select, color2Select].forEach(sel => {
      sel.innerHTML = '<option value="">Choose Color</option>';
      colors.forEach(c => sel.appendChild(new Option(c,c)));
    });
  }

  await loadColors();

  function updateBraceletPrice() {
    const type = typeSelect.value;
    const size = sizeSelect.value;
    const extras = parseInt(extrasCountInput.value) || 0;
    if(type && size && pricing[size] && pricing[size][type]!=null){
      braceletPrice.textContent = `Price: $${(pricing[size][type]+extras).toFixed(2)}`;
    } else braceletPrice.textContent = "Price: $0.00";
  }

  typeSelect.addEventListener("change", updateBraceletPrice);
  sizeSelect.addEventListener("change", updateBraceletPrice);
  extrasCountInput.addEventListener("input", updateBraceletPrice);

  async function saveColorIfNew(name){
    if(!name) return;
    const q = query(collection(db,"braceletColors"), where("name","==",name));
    const existing = await getDocs(q);
    if(existing.empty) await addDoc(collection(db,"braceletColors"),{name, addedAt: serverTimestamp()});
  }

  window.submitBraceletOrder = async () => {
    const name = document.getElementById("nameB").value.trim();
    const email = document.getElementById("emailB").value.trim();
    const color1 = color1Select.value.trim();
    const color2 = color2Select.value.trim();
    const size = sizeSelect.value;
    const type = typeSelect.value;
    const extras = parseInt(extrasCountInput.value)||0;
    const extrasDesc = document.getElementById("extrasDesc").value.trim();
    const notes = document.getElementById("braceletNotes").value.trim();
    const statusEl = document.getElementById("status");

    if(!email || !color1 || !type || !size){
      statusEl.textContent = "‚ö†Ô∏è Fill all bracelet fields!";
      statusEl.className="text-red-600 mt-2"; return;
    }
    if(extras>0 && !extrasDesc){
      statusEl.textContent="‚ö†Ô∏è Describe your extras!"; statusEl.className="text-red-600 mt-2"; return;
    }

    const total = pricing[size][type]+extras;
    try {
      await saveColorIfNew(color1);
      if(color2) await saveColorIfNew(color2);

      await addDoc(collection(db,"braceletOrders"),{
        name,email,color1,color2,type,size,extrasCount:extras,extrasDesc,notes,price:total,
        createdAt:serverTimestamp()
      });
      statusEl.textContent=`‚úÖ Bracelet order submitted! $${total.toFixed(2)}`;
      statusEl.className="text-green-600 mt-2";
      document.getElementById("braceletForm").reset();
      braceletPrice.textContent="Price: $0.00";
      await loadColors();
    } catch(e){
      console.error(e);
      statusEl.textContent="‚ùå Error submitting bracelet order";
      statusEl.className="text-red-600 mt-2";
    }
  };
});

// ===== TAB TOGGLE =====
const tabCookies = document.getElementById("tabCookies");
const tabBracelets = document.getElementById("tabBracelets");
const cookiesTab = document.getElementById("cookiesTab");
const braceletsTab = document.getElementById("braceletsTab");

tabCookies.addEventListener("click", ()=>{
  tabCookies.classList.add("active"); tabBracelets.classList.remove("active");
  cookiesTab.classList.add("active"); braceletsTab.classList.remove("active");
});
tabBracelets.addEventListener("click", ()=>{
  tabBracelets.classList.add("active"); tabCookies.classList.remove("active");
  braceletsTab.classList.add("active"); cookiesTab.classList.remove("active");
});
</script>
</body>
</html>
