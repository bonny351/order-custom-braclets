<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bracelets – Tactics & Treats Preorder</title>
<style>
body {
  font-family: "Poppins", sans-serif;
  background: linear-gradient(to right, #7a0c0c, #000, #7a0c0c);
  color: white;
  margin: 0;
  padding: 20px;
}
nav {
  text-align: center;
  background: #111;
  padding: 10px 0;
  border-bottom: 2px solid #ff0000;
  box-shadow: 0 0 10px #ff0000;
}
nav a {
  color: white;
  margin: 0 15px;
  font-weight: bold;
  text-decoration: none;
  transition: 0.2s;
}
nav a:hover { color: #ff0000; text-shadow: 0 0 6px #ff0000; }
h1 { text-align: center; color: #ff0000; margin-bottom: 30px; }
form {
  background: #111;
  border-radius: 16px;
  padding: 20px;
  margin: 20px auto;
  max-width: 500px;
  box-shadow: 0 0 15px #ff0000;
}
label { display: block; margin-top: 10px; font-weight: 500; color: white; }
input, select, button {
  width: 100%; padding: 10px; border-radius: 8px; border: none; margin-top: 5px; font-size: 14px;
}
select:disabled { background: #555; color: #aaa; cursor: not-allowed; }
button { margin-top: 20px; padding: 12px; background: #ff0000; color: #fff; font-weight: bold; border-radius: 8px; cursor: pointer; transition: 0.2s; }
button:hover { background: darkred; }
#priceDisplay { margin-top: 5px; font-weight: bold; color: #ffb347; }
.low-stock { color: #ffa500; font-weight: bold; }
.out-of-stock { color: #ff0000; font-weight: bold; }
</style>
</head>
<body>

<nav>
  <a href="cookies.html">Cookies</a>
  <a href="bracelets.html">Bracelets</a>
  <a href="spiritwear.html">Spirit Wear</a>
</nav>

<h1>Bracelet Preorder</h1>

<form id="braceletForm">
  <label>Name</label>
  <input id="braceletName" type="text" required>

  <label>Phone Number</label>
  <input id="braceletPhone" type="tel">

  <label>Email</label>
  <input id="braceletEmail" type="email">

  <label>Bracelet Type</label>
  <select id="knotType" required>
    <option value="">Select Bracelet</option>
    <option value="Cobra">Cobra</option>
    <option value="King Cobra">King Cobra</option>
    <option value="Fishtail">Fishtail</option>
    <option value="Solomon/Trilobite">Solomon / Trilobite</option>
  </select>

  <label>Size</label>
  <select id="braceletSize" required>
    <option value="">Select Size</option>
  </select>

  <p id="priceDisplay">Price: $0.00</p>

  <label>Color 1</label>
  <select id="color1" required></select>

  <label>Color 2</label>
  <select id="color2" required></select>

  <label>Clip Type</label>
  <select id="clipType" required>
    <option value="">Select Clip Type</option>
    <option value="Plastic">Plastic</option>
    <option value="Metal">Metal</option>
    <option value="Adjustable Knot">Adjustable Knot</option>
  </select>

  <label>Clip Color</label>
  <select id="clipColor" required>
    <option value="">Select Clip Color</option>
    <option value="Black">Black</option>
    <option value="Silver">Silver</option>
    <option value="Gold">Gold</option>
    <option value="Red">Red</option>
    <option value="Blue">Blue</option>
  </select>

  <label>Quantity</label>
  <input id="braceletQty" type="number" min="1" value="1" required>

  <button type="button" id="submitBtn">Submit Bracelet Order</button>
</form>

<p id="orderMsg" style="text-align:center; color:#ffb347; font-weight:bold;"></p>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, onSnapshot, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

// --- Firebase config ---
const firebaseConfig = {
  apiKey: "AIzaSyCiZuaANb1lrgdn-aARGJ_TRhgzPPUug58",
  authDomain: "bracelets-and-color.firebaseapp.com",
  projectId: "bracelets-and-color",
  storageBucket: "bracelets-and-color.appspot.com",
  messagingSenderId: "382292570673",
  appId: "1:382292570673:web:1c966e2e7e8fc2efa31b10"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const knotSelect = document.getElementById("knotType");
const sizeSelect = document.getElementById("braceletSize");
const color1Select = document.getElementById("color1");
const color2Select = document.getElementById("color2");
const clipTypeSelect = document.getElementById("clipType");
const clipColorSelect = document.getElementById("clipColor");
const priceDisplay = document.getElementById("priceDisplay");
const form = document.getElementById("braceletForm");
const orderMsg = document.getElementById("orderMsg");

// --- Price Table ---
const priceTable = {
  5:{Cobra:4.00, "King Cobra":5.25, Fishtail:3.75, "Solomon/Trilobite":4.25},
  6:{Cobra:4.75, "King Cobra":6.25, Fishtail:4.50, "Solomon/Trilobite":5.00},
  7:{Cobra:5.50, "King Cobra":7.25, Fishtail:5.25, "Solomon/Trilobite":6.00},
  8:{Cobra:6.50, "King Cobra":8.50, Fishtail:6.00, "Solomon/Trilobite":6.75},
  9:{Cobra:7.25, "King Cobra":9.50, Fishtail:6.75, "Solomon/Trilobite":7.75},
  10:{Cobra:8.00, "King Cobra":10.50, Fishtail:7.50, "Solomon/Trilobite":8.50},
  11:{Cobra:8.75, "King Cobra":11.50, Fishtail:8.25, "Solomon/Trilobite":9.25},
  12:{Cobra:9.50, "King Cobra":12.50, Fishtail:9.00, "Solomon/Trilobite":10.25},
  13:{Cobra:10.50, "King Cobra":13.75, Fishtail:9.75, "Solomon/Trilobite":11.00},
  14:{Cobra:11.25, "King Cobra":14.75, Fishtail:10.50, "Solomon/Trilobite":12.00},
  15:{Cobra:12.00, "King Cobra":15.75, Fishtail:11.25, "Solomon/Trilobite":12.75},
  16:{Cobra:12.75, "King Cobra":16.75, Fishtail:12.00, "Solomon/Trilobite":13.50},
  17:{Cobra:13.50, "King Cobra":17.75, Fishtail:12.75, "Solomon/Trilobite":14.50},
  18:{Cobra:14.50, "King Cobra":19.00, Fishtail:13.50, "Solomon/Trilobite":15.25},
  19:{Cobra:15.25, "King Cobra":20.00, Fishtail:14.25, "Solomon/Trilobite":16.25},
  20:{Cobra:16.00, "King Cobra":21.00, Fishtail:15.00, "Solomon/Trilobite":17.00},
  21:{Cobra:16.75, "King Cobra":22.00, Fishtail:15.75, "Solomon/Trilobite":17.75},
  22:{Cobra:17.50, "King Cobra":23.00, Fishtail:16.50, "Solomon/Trilobite":18.75},
  23:{Cobra:18.50, "King Cobra":24.25, Fishtail:17.25, "Solomon/Trilobite":19.50},
  24:{Cobra:19.25, "King Cobra":25.25, Fishtail:18.00, "Solomon/Trilobite":20.50},
  25:{Cobra:20.00, "King Cobra":26.25, Fishtail:18.75, "Solomon/Trilobite":21.25},
  26:{Cobra:20.75, "King Cobra":27.25, Fishtail:19.50, "Solomon/Trilobite":22.00},
  27:{Cobra:21.50, "King Cobra":28.25, Fishtail:20.25, "Solomon/Trilobite":23.00},
  28:{Cobra:22.50, "King Cobra":29.50, Fishtail:21.00, "Solomon/Trilobite":23.75},
  29:{Cobra:23.25, "King Cobra":30.50, Fishtail:21.75, "Solomon/Trilobite":24.75},
  30:{Cobra:24.00, "King Cobra":31.50, Fishtail:22.50, "Solomon/Trilobite":25.50}
};

// --- Populate color options from Firestore ---
onSnapshot(collection(db, "products_bracelets"), snapshot => {
  const colorsSet = new Set();
  color1Select.innerHTML = '<option value="">Select Color 1</option>';
  color2Select.innerHTML = '<option value="">Select Color 2</option>';
  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    if(data.colorOptions){
      data.colorOptions.forEach(color=>{
        if(!colorsSet.has(color)){
          colorsSet.add(color);
          const c1 = document.createElement("option"); c1.value=color; c1.textContent=color; color1Select.appendChild(c1);
          const c2 = document.createElement("option"); c2.value=color; c2.textContent=color; color2Select.appendChild(c2);
        }
      });
    }
  });
});

// --- Populate sizes when bracelet type is selected ---
knotSelect.addEventListener("change", () => {
  sizeSelect.innerHTML = '<option value="">Select Size</option>';
  for(let s=5; s<=30; s++){
    const opt = document.createElement("option");
    opt.value = s;
    opt.textContent = s + " in";
    sizeSelect.appendChild(opt);
  }
  priceDisplay.textContent = "Price: $0.00";
});

// --- Update price ---
function updatePrice(){
  const size = parseInt(sizeSelect.value);
  const braceletType = knotSelect.value;
  if(!size || !braceletType || !priceTable[size]){
    priceDisplay.textContent = "Price: $0.00";
    return;
  }
  const basePrice = priceTable[size][braceletType] || 0;
  priceDisplay.textContent = `Price: $${basePrice.toFixed(2)}`;
}

sizeSelect.addEventListener("change", updatePrice);
knotSelect.addEventListener("change", updatePrice);

// --- Clip logic ---
clipTypeSelect.addEventListener("change", ()=>{
  const type = clipTypeSelect.value;
  clipColorSelect.disabled = (type==="Adjustable Knot" || type==="Metal");
  if(clipColorSelect.disabled) clipColorSelect.value="";
});

// --- Submit order ---
async function submitOrder(){
  const name = document.getElementById("braceletName").value.trim();
  const phone = document.getElementById("braceletPhone").value.trim();
  const email = document.getElementById("braceletEmail").value.trim();
  const braceletType = knotSelect.value;
  const size = sizeSelect.value;
  const color1 = color1Select.value;
  const color2 = color2Select.value;
  const clipType = clipTypeSelect.value;
  const clipColor = clipColorSelect.value;
  const qty = parseInt(document.getElementById("braceletQty").value) || 1;

  if(!name || (!phone && !email) || !braceletType || !size || !color1 || !color2 || !clipType || (!clipColor && !clipColorSelect.disabled)){
    return alert("⚠️ Fill all required fields. Provide phone or email.");
  }

  const basePrice = priceTable[size][braceletType] || 0;
  const total = basePrice * qty;

  try{
    await addDoc(collection(db, "braceletOrders"), {
      name, phone: phone||null, email: email||null,
      product: braceletType, size, color1, color2,
      clipType, clipColor, qty, total,
      createdAt: new Date(), status: "Pending"
    });
    orderMsg.textContent = `✅ Order submitted! Total: $${total.toFixed(2)}`;
    form.reset(); priceDisplay.textContent="Price: $0.00"; clipColorSelect.disabled=false;
  }catch(err){
    console.error(err);
    alert("❌ Failed to submit order.");
  }
}

document.getElementById("submitBtn").addEventListener("click", submitOrder);

</script>
</body>
</html>
