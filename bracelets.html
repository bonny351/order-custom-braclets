<!<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bracelets – Tactics & Treats Preorder</title>

<style>
body {
  font-family: "Poppins", sans-serif;
  background: linear-gradient(to right, #7a0c0c, #000, #7a0c0c);
  color: white;
  margin: 0;
  padding: 20px;
}
nav {
  text-align: center;
  background: #111;
  padding: 10px 0;
  border-bottom: 2px solid #ff0000;
  box-shadow: 0 0 10px #ff0000;
}
nav a {
  color: white;
  margin: 0 15px;
  font-weight: bold;
  text-decoration: none;
  transition: 0.2s;
}
nav a:hover { color: #ff0000; text-shadow: 0 0 6px #ff0000; }

h1 { text-align: center; color: #ff0000; margin-bottom: 30px; }

form {
  background: #111;
  border-radius: 16px;
  padding: 20px;
  margin: 20px auto;
  max-width: 500px;
  box-shadow: 0 0 15px #ff0000;
}

label { display: block; margin-top: 12px; font-weight: 500; }

input, select, button {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: none;
  margin-top: 5px;
  font-size: 14px;
}

button {
  margin-top: 20px;
  padding: 12px;
  background: #ff0000;
  color: #fff;
  font-weight: bold;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s;
}
button:hover { background: darkred; }

#priceDisplay {
  margin-top: 5px;
  font-weight: bold;
  color: #ffb347;
}
</style>
</head>
<body>

<nav>
  <a href="cookies.html">Cookies</a>
  <a href="bracelets.html">Bracelets</a>
  <a href="spiritwear.html">Spirit Wear</a>
</nav>

<h1>Bracelet Preorder</h1>

<!-- OVERRIDE BOX -->
<div id="overrideBox" style="
  display:none; position:fixed; top:50%; left:50%;
  transform:translate(-50%, -50%);
  background:#111; padding:20px; border-radius:10px;
  box-shadow:0 0 12px red; z-index:100000;">
  <h3 style="margin-top:0;">Admin Override</h3>
  <input id="overrideInput" type="password" placeholder="Enter code"
    style="padding:10px; width:100%; border-radius:6px; margin-bottom:10px;">
  <button id="overrideBtn" style="
    padding:10px; background:red; color:white; border:none;
    border-radius:6px; width:100%; cursor:pointer;">
    Submit
  </button>
</div>

<form id="braceletForm">

  <label>Name</label>
  <input id="braceletName" type="text" required>

  <label>Phone Number</label>
  <input id="braceletPhone" type="tel" required>

  <label>Email</label>
  <input id="braceletEmail" type="email">

  <label>Bracelet Type</label>
  <select id="knotType" required></select>

  <label>Size</label>
  <select id="braceletSize" required></select>

  <p id="priceDisplay">Price: $0.00</p>

  <label>Color 1</label>
  <select id="color1" required></select>

  <label>Color 2</label>
  <select id="color2" required></select>

  <label>Clip Type</label>
  <select id="clipType" required>
    <option value="">Select Clip Type</option>
    <option value="Regular">Regular Clip</option>
    <option value="Flint & Steel">Flint & Steel Clip</option>
    <option value="Super Small">Super Small Clip</option>
    <option value="Metal">Metal Clip</option>
    <option value="Adjustable Knot">Adjustable Knot</option>
  </select>

  <label>Clip Color</label>
  <select id="clipColor" required></select>

  <label>Quantity</label>
  <input id="braceletQty" type="number" min="1" value="1" required>

  <label>Delivery Method</label>
  <select id="deliveryType" required>
    <option value="">Choose Delivery</option>
    <option value="pickup">Pickup at SHS (Free)</option>
    <option value="shipping">Ship Order (+$10)</option>
  </select>

  <button type="button" id="submitBtn">Submit Bracelet Order</button>

</form>

<p id="orderMsg" style="text-align:center; color:#ffb347; font-weight:bold;"></p>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import {  
  getFirestore, collection, getDocs, doc, getDoc, addDoc
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCiZuaANb1lrgdn-aARGJ_TRhgzPPUug58",
  authDomain: "bracelets-and-color.firebaseapp.com",
  projectId: "bracelets-and-color",
  storageBucket: "bracelets-and-color.appspot.com",
  messagingSenderId: "382292570673",
  appId: "1:382292570673:web:1c966e2e7e8fc2efa31b10"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const knotSelect = document.getElementById("knotType");
const sizeSelect = document.getElementById("braceletSize");
const color1Select = document.getElementById("color1");
const color2Select = document.getElementById("color2");
const clipTypeSelect = document.getElementById("clipType");
const clipColorSelect = document.getElementById("clipColor");
const qtyInput = document.getElementById("braceletQty");
const priceDisplay = document.getElementById("priceDisplay");
const deliveryType = document.getElementById("deliveryType");
const orderMsg = document.getElementById("orderMsg");

let currentPriceMap = {};
let overrideActive = false;

// LONG PRESS OVERRIDE
let pressTimer;
document.addEventListener("touchstart", () => {
  pressTimer = setTimeout(() => {
    document.getElementById("overrideBox").style.display = "block";
    document.getElementById("overrideInput").focus();
  }, 3000);
});
document.addEventListener("touchend", () => clearTimeout(pressTimer));

document.addEventListener("keydown", (e) => {
  if (e.ctrlKey && e.key === "o") {
    document.getElementById("overrideBox").style.display = "block";
    document.getElementById("overrideInput").focus();
  }
});

document.getElementById("overrideBtn").addEventListener("click", () => {
  if (document.getElementById("overrideInput").value.trim() === "20903") {
    overrideActive = !overrideActive;
    alert("Override toggled. Now: " + (overrideActive ? "FREE MODE" : "NORMAL MODE"));
    document.getElementById("overrideBox").style.display = "none";
    updatePrice();
  } else {
    alert("Incorrect code.");
  }
});

// LOAD TYPES
async function loadBraceletTypes() {
  knotSelect.innerHTML = '<option value="">Select Bracelet</option>';
  const snap = await getDocs(collection(db, "products_bracelets"));
  snap.forEach(docSnap => {
    const data = docSnap.data();
    const opt = document.createElement("option");
    opt.value = docSnap.id;
    opt.textContent = data.type || docSnap.id;
    knotSelect.appendChild(opt);
  });
}

async function loadBraceletData(typeKey) {
  if (!typeKey) return;

  const snap = await getDoc(doc(db, "products_bracelets", typeKey));

  sizeSelect.innerHTML = "";
  color1Select.innerHTML = "";
  color2Select.innerHTML = "";

  if (!snap.exists()) return;

  const data = snap.data();
  currentPriceMap = data.price || {};

  const colors = (data.colorOptions || "")
    .split(",")
    .map(c => c.trim())
    .filter(Boolean);

  const sizes = Array.isArray(data.sizeOptions) ? data.sizeOptions : [];

  sizes.forEach(size => sizeSelect.add(new Option(size, size)));
  colors.forEach(color => {
    color1Select.add(new Option(color, color));
    color2Select.add(new Option(color, color));
  });

  updatePrice();
}

function updateClipColorOptions() {
  const type = clipTypeSelect.value;
  clipColorSelect.innerHTML = "";
  let allowed = [];

  if (type === "Metal" || type === "Adjustable Knot") {
    clipColorSelect.disabled = true;
    clipColorSelect.innerHTML = '<option value="">No Color Option</option>';
    return;
  }

  allowed = ["Black", "Dark Green", "Army Green", "Tan", "Orange", "Light Green"];

  clipColorSelect.disabled = false;
  clipColorSelect.add(new Option("Select Clip Color", ""));
  allowed.forEach(c => clipColorSelect.add(new Option(c, c)));
}

function updatePrice() {
  const size = sizeSelect.value;
  const clipType = clipTypeSelect.value;
  const qty = parseInt(qtyInput.value) || 1;
  const delivery = deliveryType.value;

  let base = parseFloat(currentPriceMap[size]) || 0;
  if (clipType === "Metal") base += 1;

  let subtotal = base * qty;
  let shipping = (delivery === "shipping") ? 10 : 0;

  if (overrideActive) {
    subtotal = 0;
    shipping = 0;
  }

  const total = subtotal + shipping;
  priceDisplay.textContent = `Price: $${total.toFixed(2)}`;
}

async function submitOrder() {
  const name = braceletName.value.trim();
  const phone = braceletPhone.value.trim();
  const email = braceletEmail.value.trim();
  const type = knotType.value;
  const size = braceletSize.value;
  const color1 = color1Select.value;
  const color2 = color2Select.value;
  const clipType = clipTypeSelect.value;
  const clipColor = clipColorSelect.value;
  const qty = parseInt(braceletQty.value) || 1;
  const delivery = deliveryType.value;

  if (!name || !phone || !type || !size || !color1 || !color2 || !clipType || !delivery)
    return alert("Fill all required fields.");

  let base = parseFloat(currentPriceMap[size]) || 0;
  if (clipType === "Metal") base += 1;

  let subtotal = base * qty;
  let shipping = (delivery === "shipping") ? 10 : 0;

  if (overrideActive) {
    subtotal = 0;
    shipping = 0;
  }

  let total = subtotal + shipping;

  await addDoc(collection(db, "braceletOrders"), {
    name, phone, email,
    type, size, color1, color2,
    clipType, clipColor,
    qty,
    deliveryMethod: delivery,
    subtotal,
    shipping,
    total,
    createdAt: new Date()
  });

  orderMsg.textContent = `Order submitted! Total: $${total.toFixed(2)}`;
}

knotSelect.addEventListener("change", () => loadBraceletData(knotSelect.value));
sizeSelect.addEventListener("change", updatePrice);
qtyInput.addEventListener("change", updatePrice);
clipTypeSelect.addEventListener("change", () => { updateClipColorOptions(); updatePrice(); });
deliveryType.addEventListener("change", updatePrice);

submitBtn.addEventListener("click", submitOrder);

// INIT
loadBraceletTypes();
updateClipColorOptions();
</script>

</body>
</html>
-------------------
    // SUBMIT ORDER
    //-----------------------------
    async function submitOrder() {
      const name = document.getElementById("braceletName").value.trim();
      const phone = document.getElementById("braceletPhone").value.trim();
      const email = document.getElementById("braceletEmail").value.trim();
      const type = knotSelect.value;
      const size = sizeSelect.value;
      const color1 = color1Select.value;
      const color2 = color2Select.value;
      const clipType = clipTypeSelect.value;
      const clipColor = clipColorSelect.value;
      const qty = parseInt(qtyInput.value) || 1;

      if (!phone) return alert("⚠️ Please enter your phone number.");
      if (!name || !type || !size || !color1 || !color2 || !clipType || (!clipColor && !clipColorSelect.disabled))
        return alert("⚠️ Please fill in all required fields.");

      const base = parseFloat(currentPriceMap[size]) || 0;
      const total = (clipType === "Metal" ? base + 1 : base) * qty;

      try {
        await addDoc(collection(db, "braceletOrders"), {
          name, phone, email: email || null,
          product: type, size, color1, color2,
          clipType, clipColor,
          qty, total,
          createdAt: serverTimestamp(),
          status: "Pending"
        });
        orderMsg.textContent = `✅ Order submitted! Total: $${total.toFixed(2)}`;
        document.getElementById("braceletForm").reset();
        updateClipColorOptions();
        priceDisplay.textContent = "Price: $0.00";
      } catch (e) {
        console.error(e);
        alert("❌ Failed to submit order.");
      }
    }

    //-----------------------------
    // EVENT LISTENERS
    //-----------------------------
    knotSelect.addEventListener("change", () => {
      const typeKey = knotSelect.value;
      loadBraceletData(typeKey);
      updateBraceletImages(typeKey);
    });

    sizeSelect.addEventListener("change", updatePrice);
    qtyInput.addEventListener("change", updatePrice);

    clipTypeSelect.addEventListener("change", () => {
      updateClipColorOptions();
      updatePrice();
    });

    document.getElementById("submitBtn").addEventListener("click", submitOrder);

    //-----------------------------
    // INITIAL LOAD
    //-----------------------------
    loadBraceletTypes();
    updateClipColorOptions();

  </script>

</body>
</html>
